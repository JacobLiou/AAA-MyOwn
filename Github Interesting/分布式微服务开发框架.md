# åˆ†å¸ƒå¼å¾®æœåŠ¡å¼€å‘æ¡†æ¶



å¾®æœåŠ¡å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œåº•å±‚é€šè®¯å¯ä»¥éšæ„åˆ‡æ¢ grpcã€thriftã€‚è‡ªå¸¦æœåŠ¡å‘ç°ã€è°ƒç”¨é“¾è¿½è¸ªã€Cron è°ƒåº¦ã€é™æµã€äº‹ä»¶æ€»çº¿ã€CQRS ã€DDDã€ç±»ä¼¼MVCçš„å¼€å‘ä½“éªŒï¼Œæ’ä»¶åŒ–å¼€å‘



[åœ¨çº¿æ¼”ç¤º](http://140.143.207.244) :http://140.143.207.244

[ç¤ºä¾‹é¡¹ç›®](https://github.com/duyanming/Viper) :https://github.com/duyanming/Viper

## ğŸ„Nuget åŸºç¡€

|Description   |
|--------------|
|é…ç½®åº“ |
|æ—¥å¿—åº“ |
|ä¾èµ–æ³¨å…¥åº“ |
|ä»»åŠ¡è°ƒåº¦åº“ |
|ä¸šåŠ¡å¤„ç†åŸºç¡€åº“ |

## ğŸƒNuget é€šä¿¡

|Description       |
|------------------|
|Thriftæ³¨å†Œä¸­å¿ƒåº“  |
|Thriftå®¢æˆ·ç«¯åº“|
|Thrift ServeræœåŠ¡åº“ |
|Grpcæ³¨å†Œä¸­å¿ƒåº“ |
|Grpcå®¢æˆ·ç«¯åº“ |
|GrpcServeræœåŠ¡åº“ |

## ğŸNuget æ‰©å±•

|Description     |
|----------------|
|EventBusäº‹ä»¶æ€»çº¿åº“ |
|ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶é™æµåº“ |
|AnnoæœåŠ¡é™æµä¸­é—´ä»¶|
|ç¼“å­˜åº“ |
|AnnoæœåŠ¡ç¼“å­˜ä¸­é—´ä»¶ |
|AnnoæœåŠ¡ç›‘æ§ä¸­é—´ä»¶ |
|æ¥å£ä»£ç†Annoå®¢æˆ·ç«¯æ‰©å±• |

## ğŸ‚æ•´ä½“æ¶æ„
![æ•´ä½“æ¶æ„](https://s3.ax1x.com/2020/12/18/rtegcd.png)

æ•´ä½“æ¶æ„ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†

ã€€ã€€1ã€æ³¨å†Œä¸­å¿ƒï¼šAnnoCenter 

ã€€ã€€2ã€å¾®æœåŠ¡ï¼šAnnoServiceï¼ˆå¯ä»¥æ˜¯å¤šä¸ªæœåŠ¡ä¾‹å¦‚ï¼šè®¢å•æœåŠ¡Aã€åº“å­˜æœåŠ¡Bã€æ”¯ä»˜æœåŠ¡Cã€ç”¨æˆ·æœåŠ¡Dï¼‰

ã€€ã€€3ã€ApiGatewayï¼š[å‚è€ƒViper](https://github.com/duyanming/Viper)
ã€€ã€€
# ğŸ“¢ä¸»è¦åŠŸèƒ½

ã€€ã€€æœåŠ¡æ³¨å†Œä¸­å¿ƒã€æœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€è´Ÿè½½å‡è¡¡ã€é™æµã€å¤±è´¥é‡è¯•ã€é“¾è·¯è¿½è¸ªã€èµ„æºç›‘æ§ç­‰åŠŸèƒ½


# ğŸ“¦æ³¨å†Œä¸­å¿ƒ(AnnoCenter)

ã€€ã€€AnnoCenter æ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œä¸»è¦èŒè´£æ˜¯ å‘ç°æœåŠ¡ï¼ˆä¾‹å¦‚è®¢å•æœåŠ¡Aã€åº“å­˜æœåŠ¡Bï¼‰ã€å­˜å‚¨æœåŠ¡é…ç½®ä¿¡æ¯ã€å¥åº·æ£€æŸ¥ã€ç®€å•é”®å€¼KVå­˜å‚¨ã€‚å®¢æˆ·ç«¯å®šæ—¶ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ä¿¡æ¯ç¼“å­˜åˆ°æœ¬åœ°ã€‚å³ä¾¿æ³¨å†Œä¸­å¿ƒå®•æœºä¹Ÿä¸å½±å“æ•´ä¸ªé›†ç¾¤è¿è¡Œï¼Œå› ä¸ºå®¢æˆ·ç«¯å·²ç»ç¼“å­˜äº†æ•´ä¸ªé›†ç¾¤çš„æœåŠ¡ä¿¡æ¯ã€‚ä½†æ˜¯æ–°åŠ å…¥çš„æœåŠ¡æ— æ³•æ³¨å†Œè¿›æ¥ï¼Œéœ€è¦å¯åŠ¨æ³¨å†Œä¸­å¿ƒæ‰å¯ä»¥ã€‚
ã€€ã€€å®¢æˆ·ç«¯(ä¾‹å¦‚ï¼šApiGateway )å‘é€è¿‡æ¥è¯·æ±‚æ—¶,å®¢æˆ·ç«¯ç±»åº“ä»æœ¬åœ°ç¼“å­˜æ‰¾å‡ºèƒ½å¤Ÿå¤„ç†æ­¤è¯·æ±‚çš„æœåŠ¡åˆ—è¡¨ï¼ˆè¿™ä¸ªè¿‡ç¨‹å¯èƒ½æ¶‰åŠæƒé‡ç­‰ç­–ç•¥ï¼‰é€‰æ‹©ä¸€ä¸ªå»å¤„ç†è¯·æ±‚ï¼Œç„¶åè¿”å›ï¼Œå¦‚æœå¤±è´¥ä¼šæœ‰é‡è¯•æœºåˆ¶ã€‚
ã€€ã€€æ³¨å†Œä¸­å¿ƒä¼šå®šæ—¶å¯¹æ¯ä¸ªæœåŠ¡åšå¥åº·æ£€æŸ¥ï¼Œå¦‚æœè¿æ¥ä¸ä¸ŠæœåŠ¡åˆ™æ ‡è®°æ­¤æœåŠ¡ä¸ºäºšå¥åº·çŠ¶æ€ï¼Œæ­¤æ—¶ä¸ä¼šå°†æ­¤æœåŠ¡è¸¢å‡ºä¹Ÿä¸ä¼šå°†è‡ªæœåŠ¡è¿”å›ç»™å®¢æˆ·å•ä½¿ç”¨ï¼Œç„¶åå¼€å§‹é‡å¤åšæ£€æŸ¥ã€‚å¦‚æœä¸€åˆ†é’Ÿå†…æ¢å¤æ­£å¸¸åˆ™é‡æ–°æ ‡è®°ä¸ºå¥åº·çŠ¶æ€åˆ‡å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¦åˆ™æ°¸ä¹…è¸¢å‡ºæœåŠ¡ã€‚
    

    æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆAnnoCenterï¼‰ æ˜¯æ•´ä¸ªé›†ç¾¤ç¬¬ä¸€ä¸ªéœ€è¦è¿è¡Œèµ·æ¥çš„ç¨‹åºã€‚

é…ç½®æ–‡ä»¶ï¼šåªéœ€è¦é…ç½®ç«¯å£ã€è¶…æ—¶æ—¶é—´å³å¯ã€‚æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯ä¼šåœ¨æœåŠ¡æ³¨å†Œè¿›æ¥çš„æ—¶å€™è‡ªåŠ¨å†™å…¥

```xml

    <?xml version="1.0" encoding="utf-8"?>
    <configuration>
      <!--#lbs é…ç½® Port æ³¨å†Œä¸­å¿ƒç›‘å¬ç«¯å£ TimeOut è¶…æ—¶æ—¶é—´æ¯«ç§’
      dcï¼šèŠ‚ç‚¹
      dc:nicknameï¼šæœåŠ¡åç§° App001
      dc:name: åŠŸèƒ½tag
      dc:ip:æœåŠ¡IP
      dc:port:æœåŠ¡ç«¯å£
      dc:timeout:æœåŠ¡è¶…æ—¶æ—¶é—´
      dc:weight:æœåŠ¡æƒé‡ æ•°å­—
      -->
      <Port>6660</Port>
      <TimeOut>120000</TimeOut>
      <Servers>
        <dc name="Anno.Plugs.TraceService,Anno.Plugs.DLockService,Anno.Plugs.EsLogService" nickname="App001" ip="10.112.93.122" port="6659" timeout="20000" weight="1" />
      </Servers>
    </configuration>

```

# ğŸ‘‘æœåŠ¡(AnnoService)
æœåŠ¡å®¿ä¸»ç¨‹åºï¼Œæœ¬ç€çº¦å®šå¤§äºé…ç½®çš„å¼€å‘åŸåˆ™ã€‚
æ’ä»¶å¼å¼€å‘å…·ä½“å‚è€ƒï¼š
Packages

    å‘½åç©ºé—´å’Œç¨‹åºé›†åç§°ç›¸åŒï¼Œæ ¼å¼ä¸ºAnno.Plugs.XXXService ä¾‹å¦‚ï¼šAnno.Plugs.HelloWorldService
    
    åˆå§‹åŒ–é…ç½®    
    å®ç°æ¥å£ï¼šIPlugsConfigurationBootstrap

```cs
using Anno.EngineData;
using System;

namespace Anno.Plugs.HelloWorldService
{
    /// <summary>
    /// æ’ä»¶å¯åŠ¨å¼•å¯¼å™¨
    /// DependsOn ä¾èµ–çš„ç±»å‹ç¨‹åºé›†è‡ªåŠ¨æ³¨å…¥DIå®¹å™¨
    /// </summary>
    [DependsOn(
        //typeof(Domain.Bootstrap)
        //, typeof(QueryServices.Bootstrap)
        //, typeof(Repository.Bootstrap)
        //, typeof(Command.Handler.Bootstrap
        )]
    public class HelloWorldBootStrap : IPlugsConfigurationBootstrap
    {
        /// <summary>
        /// Service ä¾èµ–æ³¨å…¥æ„å»ºä¹‹åè°ƒç”¨
        /// </summary>
        public void ConfigurationBootstrap()
        {
            //throw new NotImplementedException();
        }
        /// <summary>
        /// Service ä¾èµ–æ³¨å…¥æ„å»ºä¹‹å‰è°ƒç”¨
        /// </summary>
        /// </summary>
        public void PreConfigurationBootstrap()
        {
            //throw new NotImplementedException();
        }
    }
}

```

åŠŸèƒ½æ¨¡å—å®ç°
ç»§æ‰¿: BaseModule

Moduleå‘½åè§„èŒƒä¸º XXXModuleï¼Œä»¥Moduleç»“å°¾ ä¾‹å¦‚ï¼šHelloWorldViperModule
```cs
/****************************************************** 
Writer:Du YanMing
Mail:dym880@163.com
Create Date:2020/10/30 13:15:24 
Functional descriptionï¼š HelloWorldViperModule
******************************************************/
using System;
using System.Collections.Generic;
using System.Text;

namespace Anno.Plugs.HelloWorldService
{
    using Anno.Const.Attribute;
    using Anno.EngineData;
    using HelloWorldDto;
    using System.ComponentModel.DataAnnotations;

    public class HelloWorldViperModule : BaseModule
    {
        [AnnoInfo(Desc = "ä¸–ç•Œä½ å¥½å•ŠSayHi")]
        public dynamic SayHello([AnnoInfo(Desc = "ç§°å‘¼")] string name, [AnnoInfo(Desc = "å¹´é¾„")] int age)
        {
            Dictionary<string, string> input = new Dictionary<string, string>();
            input.Add("vname", name);
            input.Add("vage", age.ToString());
            var soEasyMsg = Newtonsoft.Json.JsonConvert.DeserializeObject<ActionResult<string>>(this.InvokeProcessor("Anno.Plugs.SoEasy", "AnnoSoEasy", "SayHi", input)).OutputData;
            return new { HelloWorldViperMsg = $"{name}ä½ å¥½å•Šï¼Œä»Šå¹´{age}å²äº†", SoEasyMsg = soEasyMsg };
        }
    
        [AnnoInfo(Desc = "ä¸¤ä¸ªæ•´æ•°ç›¸å‡ç­‰äºå‡ ï¼Ÿæˆ‘æ¥å¸®ä½ ç®—ï¼ˆx-y=?ï¼‰")]
        public int Subtraction([AnnoInfo(Desc = "æ•´æ•°X")] int x, [AnnoInfo(Desc = "æ•´æ•°Y")] int y)
        {
            return x - y;
        }
        [AnnoInfo(Desc = "ä¹°ä¸ªå•†å“å§ï¼ŒåŒåä¸€é©¬ä¸Šå°±æ¥äº†")]
        public ProductDto BuyProduct([AnnoInfo(Desc = "å•†å“åç§°")] string productName, [AnnoInfo(Desc = "å•†å“æ•°é‡")] int number)
        {
            double price = new Random().Next(2, 90);
            Dictionary<string, string> input = new Dictionary<string, string>();
            input.Add("productName", productName);
            input.Add("number", number.ToString());
            var product = Newtonsoft.Json.JsonConvert.DeserializeObject<ActionResult<ProductDto>>(this.InvokeProcessor("Anno.Plugs.SoEasy", "AnnoSoEasy", "BuyProduct", input)).OutputData;
            product.CountryOfOrigin = $"ä¸­å›½åŒ—äº¬ä¸­è½¬--{ product.CountryOfOrigin}";
            return product;
        }       
    }
}

```

é…ç½®æ–‡ä»¶ï¼š
  ```xml

    <?xml version="1.0" encoding="utf-8" ?>
    <configuration>
      <!--0,0 ç¬¬ä¸€ä½æ˜¯ å·¥ä½œç«™ï¼Œç¬¬äºŒä½æ•°æ®ä¸­å¿ƒ
      ï¼ˆæ‰€æœ‰çš„ AnnoService çš„ ä¸¤ä½æ•°ä¸èƒ½é‡å¤ä¾‹å¦‚ä¸èƒ½å­˜åœ¨ã€1,2ã€‘ã€1,2ã€‘ï¼‰
      å¯ä»¥å­˜åœ¨ã€1,2ã€‘ã€2,1ã€‘
      -->
      <IdWorker>0,0</IdWorker>
      <!--Appåç§°-->
      <AppName>App001</AppName>
      <!--ç›‘å¬ç«¯å£-->
      <Port>6659</Port>
      <!--æƒé‡-->
      <Weight>1</Weight>
      <!--åŠŸèƒ½--> 
      <FuncName>Anno.Plugs.LogicService,Anno.Plugs.TraceService</FuncName>
      <!--å¿½ç•¥çš„åŠŸèƒ½ Trace,Logic-->
      <IgnoreFuncName></IgnoreFuncName>
      <!--è¶…æ—¶æ—¶é—´æ¯«ç§’-->
      <TimeOut>20000</TimeOut>
      <!--æ³¨å†Œåˆ°çš„ç›®æ ‡-->
      <Ts Ip="10.112.93.122" Port="6660"/>
      <IocDll>
        <!-- IOC ä»“å‚¨ã€é¢†åŸŸ-->
        <Assembly>Anno.Repository</Assembly>
      </IocDll>
      <appSettings>
       
       </appSettings>
    </configuration>

  ```

# ğŸ„ç½‘å…³

[å‚è€ƒViper](https://github.com/duyanming/Viper)
